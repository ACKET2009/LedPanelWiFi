# Звуки будильника

Если ваше устройство включает в себя подключенный модуль **MP3 DFPlayer**, вам, вероятно, будет полезным знать как
прошивка находит нужные ей звуки, как заменить звуки из проекта на свои собственные.  

## Где хранятся звуки

Каждый звук, используемый системой, хранится в звуковом файле в формате MP3 на microSD-карточке, которая вставлена в 
модуль DFPlayer\`а.

### Папки

![DFPlayer](https://github.com/vvip-68/LedPanelWiFi/blob/main/wiki/DFPlayer/p01.png)

SD карточка в MP3 плеере (DFPlayer) содержит в корне три папки - **"01"**, **"02"** и **"03"**  
- Папка **"01"** содержит MP3 файлы звуков, проигрываемых при наступлении события будильника  
- Папка **"02"** содержит MP3 файлы звуков, проигрываемых при наступлении события рассвета  
- Папка **"03"** содержит MP3 файлы звуков, проигрываемых в макросе {A} бегущей строки  

DFPlayer не имеет возможности считывать имена файлов, только возможность получить количество файлов в папке. 
Команда на воспроизведение звука означает - *играть файл с индексом (номером)* ***N*** *из папки* ***M***.
Номера файлов определяются таблицей размещения файлов SD-карты (*FAT*), которая формируется в порядке очереди записи файлов на чистую флэшку.
Так, файл записанный в папку первым получает *номер 1*, второй - *номер 2* и так далее и никак не зависит от имен файлов.  

### Подготовка файлов

Для формирования правильного порядка файлов звуков переименуйте их на компьютере во временной папке так, чтобы они 
формировали нужный порядок, например - задайте им просто числовые имена вроде ***001.mp3***, ***002.mp3*** и так далее или 
задайте числовой префикс существующему имени, например ***01_birds.mp3***, ***02_thunder.mp3*** и так далее. 
Файлы в папке должны быть отсортированы в порядке следования имен, как они указаны в списке звуков в файле ***a_def_lang.h***. 

![DFPlayer](https://github.com/vvip-68/LedPanelWiFi/blob/main/wiki/DFPlayer/p02.png)

Далее создайте на чистой microSD-карте папку в которую будут помещены звуковые файлы и скопируйте их в 
упорядоченном списке.

Теперь карта подготовлена и ее можно вставлять в DFPlayer.

Файлы звуков проекта можно загрузить по [ссылке](https://drive.google.com/drive/folders/1hT-7gyaSzE2zhBmFVFOsA_XrPcXeduvL?usp=sharing)
из папок **01**, **02** и **03**.

### Настройка списка звуков в скетче

Так как плеер не знает имен файлов, устройству нужно сообщить соответствие между записанными на SD-карту по порядку файлами
и их именами, как они должны отображаться в Web-приложении.  

Откройте Arduino IDE, файл / закладка **a_def_lang.h**.  

![DFPlayer](https://github.com/vvip-68/LedPanelWiFi/blob/main/wiki/DFPlayer/p03.png)

Найдите строки со списком имен файлов для звуков будильника - **ALARM_SOUND_LIST**, рассвета - **DAWN_SOUND_LIST**
и звуков макроса *{A}* бегущей строки - **NOTIFY_SOUND_LIST**. Замените имена (названия) звуков в списках на ваши, записав их в том же порядке,
в каком они были скопированы на microSD-карточку.  

На этом подготовка звуков для прошивки завершена.  
Выполните сборку проекта и загрузку скомпилированного скетча в микроконтроллер.  